<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>首页 - "未卜先治"</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <!-- 加载主题工具脚本 -->
    <script src="/static/js/theme-utils.js"></script>
    <style>
  #batchPredictCard,
  #contactAndReply {
    display: none !important;
  }
</style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-hospital me-2"></i> "未卜先治"
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="/dashboard"><i class="bi bi-house-door" style="margin-right: 0.25rem;"></i> 首页</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/predictor/single"><i class="bi bi-person-check" style="margin-right: 0.25rem;"></i> 单例预测</a>
                    </li>
                    <li class="nav-item" id="batchPredictLink" style="display: none;">
                        <a class="nav-link" href="/predictor/batch"><i class="bi bi-people" style="margin-right: 0.25rem;"></i> 多例预测</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/medical-qa"><i class="bi bi-chat-dots" style="margin-right: 0.25rem;"></i> 智能问诊</a>
                    </li>
                    <li class="nav-item" id="dataDashboardLink" style="display: none;">
                        <a class="nav-link" href="/data-dashboard"><i class="bi bi-graph-up" style="margin-right: 0.25rem;"></i> 数据看板</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/settings"><i class="bi bi-gear" style="margin-right: 0.25rem;"></i> 设置</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/about"><i class="bi bi-info-circle" style="margin-right: 0.25rem;"></i> 关于我们</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/my-feedback"><i class="bi bi-chat-square-text" style="margin-right: 0.25rem;"></i> 咨询留言</a>
                    </li>
                    <li class="nav-item" id="adminLink" style="display: none;">
                        <a class="nav-link" href="/admin"><i class="bi bi-shield-lock" style="margin-right: 0.25rem;"></i> 医师控制台</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    <button class="btn btn-outline-light btn-sm" id="logoutBtn">
                        <i class="bi bi-box-arrow-right me-1"></i>退出
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="welcome-section animate-fade-in">
        <div class="container">
            <h1 class="display-5">欢迎进入"未卜先治"，<span id="username">{{ username }}</span></h1>
            <p class="lead">选择下方功能开始使用系统</p>
        </div>
    </div>

    <div class="container mb-5">
        <!-- 主要功能卡片 -->
        <div class="row mb-4">
            <div class="col-md-4 animate-fade-in-delay-1">
                <div class="feature-card" onclick="window.location.href='/predictor/single'">
                    <div class="card-body text-center">
                        <i class="bi bi-person-check"></i>
                        <h3 class="card-title">单例风险预测</h3>
                        <p class="card-text">输入单个患者数据进行HAPI风险预测并生成报告</p>
                        <button class="btn btn-primary">开始预测</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4 animate-fade-in-delay-2" id="batchPredictCard">
                <div class="feature-card" onclick="window.location.href='/predictor/batch'">
                    <div class="card-body text-center">
                        <i class="bi bi-people"></i>
                        <h3 class="card-title">多例风险预测</h3>
                        <p class="card-text">上传包含多个患者数据的表格文件进行多例预测</p>
                        <button class="btn btn-success">批量预测</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4 animate-fade-in-delay-2" id="contactAndReply">
                <div class="feature-card" onclick="window.location.href='/my-feedback'">
                    <div class="card-body text-center">
                        <i class="bi bi-people"></i>
                        <h3 class="card-title">咨询专业医师</h3>
                        <p class="card-text">查看您提交的咨询和专业医师的回复</p>
                        <button class="btn btn-success">咨询留言</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4 animate-fade-in-delay-3">
                <div class="feature-card" onclick="window.location.href='/medical-qa'">
                    <div class="card-body text-center">
                        <i class="bi bi-chat-dots"></i>
                        <h3 class="card-title">智能医疗问答</h3>
                        <p class="card-text">基于医学知识库的智能问答系统</p>
                        <button class="btn btn-info">开始咨询</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 医疗知识卡片 -->
        <h2 class="mb-4 animate-fade-in-delay-1">HAPI知识速览</h2>
        <div class="row row-cols-1 row-cols-md-3 g-4 mb-4">
            <div class="col animate-fade-in-delay-1">
                <div class="card medical-tip-card h-100">
                    <div class="card-body">
                        <h5 class="card-title">什么是HAPI（医院获得性压力性损伤）</h5>
                        <p class="card-text">HAPI是指患者在住院期间因医疗照护不当、持续压迫等原因引发的压力性损伤，常见于长期卧床或行动受限的老年人。</p>
                    </div>
                </div>
            </div>
            <div class="col animate-fade-in-delay-2">
                <div class="card medical-tip-card h-100">
                    <div class="card-body">
                        <h5 class="card-title">HAPI常见发生部位</h5>
                        <p class="card-text">医院获得性压伤常发生于骶尾部、足跟、肩胛部和髋部等骨突出区域，这些区域在受压时血液循环易受阻。</p>
                    </div>
                </div>
            </div>
            <div class="col animate-fade-in-delay-3">
                <div class="card medical-tip-card h-100">
                    <div class="card-body">
                        <h5 class="card-title">HAPI的分期与表现</h5>
                        <p class="card-text">HAPI分为四期，从皮肤完整但发红开始，逐渐发展为皮肤破损、深层组织坏死甚至骨骼暴露，越早识别干预效果越好。</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 更多医疗知识卡片 -->
        <div class="row row-cols-1 row-cols-md-3 g-4">
            <div class="col animate-fade-in-delay-1">
                <div class="card medical-tip-card h-100">
                    <div class="card-body">
                        <h5 class="card-title">HAPI的预防措施</h5>
                        <p class="card-text">定期变换体位、使用减压装置、保持皮肤干燥清洁、加强营养支持等，是预防HAPI的重要措施。</p>
                    </div>
                </div>
            </div>
            <div class="col animate-fade-in-delay-2">
                <div class="card medical-tip-card h-100">
                    <div class="card-body">
                        <h5 class="card-title">HAPI的护理与治疗</h5>
                        <p class="card-text">轻度压伤可通过保持伤口清洁、适当敷料进行处理；重度则可能需要清创或外科手术，治疗期间应持续减压与加强营养。</p>
                    </div>
                </div>
            </div>
            <div class="col animate-fade-in-delay-3">
                <div class="card medical-tip-card h-100">
                    <div class="card-body">
                        <h5 class="card-title">人工智能医疗助手</h5>
                        <p class="card-text">AI医疗助手能够提供24h的医疗咨询服务，但仅供参考，重要医疗决策仍需咨询专业医生。</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="py-4 mt-5">
        <div class="container text-center">
            <p class="mb-0">© 2025 "未卜先治". 保留所有权利.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- 引入JavaScript文件 -->
    <script src="/static/js/auth.js"></script>
    <script src="/static/js/dashboard.js"></script>
    
    <!-- 权限检查脚本 -->
    <script>
  // 💡 封装为函数，根据用户角色显示正确卡片
  function showCardByUserRole(role) {
    const contactCard = document.getElementById('contactAndReply');
    const batchCard = document.getElementById('batchPredictCard');

    if (!contactCard || !batchCard) return;

    if (role === 'admin') {
      contactCard.style.setProperty('display', 'none', 'important');
      batchCard.style.setProperty('display', 'block', 'important');
    } else {
      batchCard.style.setProperty('display', 'none', 'important');
      contactCard.style.setProperty('display', 'block', 'important');
    }
  }

  document.addEventListener('DOMContentLoaded', async function () {
    console.log('DOM 加载完成，准备执行身份识别');

    // 💡 等待 authManager 初始化（如果是异步的）
    if (window.authManager && typeof authManager.init === 'function') {
      await authManager.init();
    }

    // 💡 从 localStorage 获取身份（建议后端写入）
    const userRole = localStorage.getItem('user_role') || 'user';
    console.log('当前用户角色是：', userRole);

    // 💡 控制显示卡片
    showCardByUserRole(userRole);
  });
</script>
</body>
</html> 
