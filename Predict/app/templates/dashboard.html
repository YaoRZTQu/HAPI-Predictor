<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <!-- 加载主题工具脚本 -->
    <script src="/static/js/theme-utils.js"></script>
    <style>
  #batchPredictCard,
  #contactAndReply {
    display: none !important;
  }
</style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-hospital me-2"></i> HAPI
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="/dashboard"><i class="bi bi-house-door" style="margin-right: 0.25rem;"></i> Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/predictor/single"><i class="bi bi-person-check" style="margin-right: 0.25rem;"></i> Single prediction</a>
                    </li>
                    <li class="nav-item" id="batchPredictLink" style="display: none;">
                        <a class="nav-link" href="/predictor/batch"><i class="bi bi-people" style="margin-right: 0.25rem;"></i> Multiple predictions</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/medical-qa"><i class="bi bi-chat-dots" style="margin-right: 0.25rem;"></i> Intelligent consultation</a>
                    </li>
                    <li class="nav-item" id="dataDashboardLink" style="display: none;">
                        <a class="nav-link" href="/data-dashboard"><i class="bi bi-graph-up" style="margin-right: 0.25rem;"></i> Data Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/settings"><i class="bi bi-gear" style="margin-right: 0.25rem;"></i> Settings</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/about"><i class="bi bi-info-circle" style="margin-right: 0.25rem;"></i> About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/my-feedback"><i class="bi bi-chat-square-text" style="margin-right: 0.25rem;"></i> Inquiry Message</a>
                    </li>
                    <li class="nav-item" id="adminLink" style="display: none;">
                        <a class="nav-link" href="/admin"><i class="bi bi-shield-lock" style="margin-right: 0.25rem;"></i> Physician Console</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    <button class="btn btn-outline-light btn-sm" id="logoutBtn">
                        <i class="bi bi-box-arrow-right me-1"></i>Exit
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="welcome-section animate-fade-in">
        <div class="container">
            <h1 class="display-5">Welcome to this system,<span id="username">{{ username }}</span></h1>
            <p class="lead">Select a function below to start using the system</p>
        </div>
    </div>

    <div class="container mb-5">
        <!-- 主要功能卡片 -->
        <div class="row mb-4">
            <div class="col-md-4 animate-fade-in-delay-1">
                <div class="feature-card" onclick="window.location.href='/predictor/single'">
                    <div class="card-body text-center">
                        <i class="bi bi-person-check"></i>
                        <h3 class="card-title">Singleton Risk Prediction</h3>
                        <p class="card-text">Enter individual patient data to predict HAPI risk and generate a report</p>
                        <button class="btn btn-primary">Start Prediction</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4 animate-fade-in-delay-2" id="batchPredictCard">
                <div class="feature-card" onclick="window.location.href='/predictor/batch'">
                    <div class="card-body text-center">
                        <i class="bi bi-people"></i>
                        <h3 class="card-title">Multiple case risk prediction</h3>
                        <p class="card-text">Upload a spreadsheet containing data of multiple patients for multi-case prediction</p>
                        <button class="btn btn-success">Batch prediction</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4 animate-fade-in-delay-2" id="contactAndReply">
                <div class="feature-card" onclick="window.location.href='/my-feedback'">
                    <div class="card-body text-center">
                        <i class="bi bi-people"></i>
                        <h3 class="card-title">Consult a professional doctor</h3>
                        <p class="card-text">View the inquiries you submitted and the responses from professional doctors</p>
                        <button class="btn btn-success">Inquiry Message</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4 animate-fade-in-delay-3">
                <div class="feature-card" onclick="window.location.href='/medical-qa'">
                    <div class="card-body text-center">
                        <i class="bi bi-chat-dots"></i>
                        <h3 class="card-title">Intelligent Medical Q&A</h3>
                        <p class="card-text">Intelligent Question-and-Answer System Based on a Medical Knowledge Base</p>
                        <button class="btn btn-info">Start Consultation</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 医疗知识卡片 -->
        <h2 class="mb-4 animate-fade-in-delay-1">HAPI Knowledge Overview</h2>
        <div class="row row-cols-1 row-cols-md-3 g-4 mb-4">
            <div class="col animate-fade-in-delay-1">
                <div class="card medical-tip-card h-100">
                    <div class="card-body">
                        <h5 class="card-title">What is HAPI (Hospital-Acquired Pressure Injury)</h5>
                        <p class="card-text">HAPI refers to pressure injuries that occur in patients during hospitalization due to improper medical care, prolonged pressure, and other factors, commonly seen in elderly individuals who are bedridden or have limited mobility.</p>
                    </div>
                </div>
            </div>
            <div class="col animate-fade-in-delay-2">
                <div class="card medical-tip-card h-100">
                    <div class="card-body">
                        <h5 class="card-title">Common Sites of HAPI</h5>
                        <p class="card-text">Hospital-acquired pressure injuries often occur in bony protrusion areas such as the sacrococcygeal region, heels, scapulae, and hips, where blood circulation is easily obstructed when compressed.</p>
                    </div>
                </div>
            </div>
            <div class="col animate-fade-in-delay-3">
                <div class="card medical-tip-card h-100">
                    <div class="card-body">
                        <h5 class="card-title">HAPI's Staging and Presentation</h5>
                        <p class="card-text">HAPI is divided into four stages, starting with intact but reddened skin and gradually progressing to skin damage, deep tissue necrosis, and even exposed bone. The earlier it is identified and intervened, the better the outcome.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 更多医疗知识卡片 -->
        <div class="row row-cols-1 row-cols-md-3 g-4">
            <div class="col animate-fade-in-delay-1">
                <div class="card medical-tip-card h-100">
                    <div class="card-body">
                        <h5 class="card-title">Preventive measures for HAPI</h5>
                        <p class="card-text">Regularly changing positions, using pressure-relief devices, keeping the skin dry and clean, and enhancing nutritional support are important measures to prevent HAPI.</p>
                    </div>
                </div>
            </div>
            <div class="col animate-fade-in-delay-2">
                <div class="card medical-tip-card h-100">
                    <div class="card-body">
                        <h5 class="card-title">Nursing and Treatment of HAPI</h5>
                        <p class="card-text">Mild contusions can be treated by keeping the wound clean and using appropriate dressings; severe cases may require debridement or surgery, and during treatment, continuous pressure relief and enhanced nutrition should be maintained.</p>
                    </div>
                </div>
            </div>
            <div class="col animate-fade-in-delay-3">
                <div class="card medical-tip-card h-100">
                    <div class="card-body">
                        <h5 class="card-title">Artificial Intelligence Medical Assistant</h5>
                        <p class="card-text">AI medical assistants can provide 24-hour medical consultation services, but they are for reference only; important medical decisions still require consulting a professional doctor.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="py-4 mt-5">
        <div class="container text-center">
            <p class="mb-0">© 2025 HAPI System. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- 引入JavaScript文件 -->
    <script src="/static/js/auth.js"></script>
    <script src="/static/js/dashboard.js"></script>
    
    <!-- 权限检查脚本 -->
    <script>
  // 💡 封装为函数：根据用户角色显示正确内容
  function showCardByUserRole(role) {
    const contactCard = document.getElementById('contactAndReply');
    const batchCard = document.getElementById('batchPredictCard');
    const dashboardLink = document.getElementById('dataDashboardLink');
    const batchLink = document.getElementById('batchPredictLink');

    // 若有元素不存在，则跳过处理
    if (!contactCard || !batchCard || !dashboardLink || !batchLink) return;

    if (role === 'admin') {
      // 显示管理员相关内容
      contactCard.style.setProperty('display', 'none', 'important');
      batchCard.style.setProperty('display', 'block', 'important');
      dashboardLink.style.setProperty('display', 'inline-block', 'important');
      batchLink.style.setProperty('display', 'inline-block', 'important');
    } else {
      // 显示普通用户内容
      batchCard.style.setProperty('display', 'none', 'important');
      contactCard.style.setProperty('display', 'block', 'important');
      dashboardLink.style.setProperty('display', 'none', 'important');
      batchLink.style.setProperty('display', 'none', 'important');
    }
  }

  document.addEventListener('DOMContentLoaded', async function () {
    console.log('DOM 加载完成，准备执行身份识别');

    // 💡 等待 authManager 初始化（若是异步身份系统）
    if (window.authManager && typeof authManager.init === 'function') {
      await authManager.init();
    }

    // 💡 从 localStorage 获取身份（建议由后端设置）
    const userRole = localStorage.getItem('user_role') || 'user';
    console.log('当前用户角色是：', userRole);

    // 💡 控制显示元素
    showCardByUserRole(userRole);
  });
</script>
</body>
</html> 
